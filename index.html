<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DevOps Terminology Toolkit</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Source+Code+Pro&display=swap" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <style>
    body { background:#1e1e1e; color:#eaeaea; overflow:hidden; }
    .sidebar { height:100vh; overflow-y:auto; background:#f8f9fa; border-right:1px solid #ddd; padding:1rem; }
    .sidebar h2 { font-family:'Montserrat',sans-serif; font-weight:700; font-size:0.75rem; margin-bottom:1rem; color:#0d6efd; display:flex; justify-content:space-between; align-items:center; }
    .search-box { margin-bottom:1rem; }
    .instructions { font-size: 0.75rem; margin-bottom:1rem; }
    .btn-random, .btn-contribute { margin-bottom:.5rem; width:100%; }
    .settings-icon { cursor:pointer; font-size:1.2rem; color:#0d6efd; }
    .settings-pulse { animation:pulse 1s infinite; }
    @keyframes pulse { 0% {transform:scale(1);} 50% {transform:scale(1.2);} 100% {transform:scale(1);} }
    .word-list { list-style:none; padding-left:0; margin:0; }
    .word-list li { padding:.5rem .75rem; cursor:pointer; border-radius:8px; transition:background .2s,color .2s; font-weight:500; color:#333; }
    .word-list li:hover, .word-list li.active { background:#0d6efd; color:white; }
    .content { padding:2rem; height:100vh; overflow-y:auto; background:#111; font-family:'Source Code Pro',monospace; border-left:2px solid #0d6efd; }
    .terminal-header { background:#0d6efd; color:white; padding:0.5rem 1rem; border-radius:8px 8px 0 0; font-size:0.9rem; margin-bottom:0; }
    .terminal-window { background:#1e1e1e; padding:1.5rem; border-radius:0 0 8px 8px; box-shadow:0 0 10px rgba(13,110,253,0.4); }

    /* Refined Word of the Day styling */
    .word-of-day-block {
      background: #2a2a2a;
      border-left: none;
      padding: 0.75rem 1rem;
      border-radius: 4px;
      margin-bottom: 1.5rem;
      font-size: 0.9rem;
      color: #bbb;
    }
    .word-of-day-block h2 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #888;
    }
    .word-of-day-inline {
      font-size: 0.95rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
      color: #ccc;
    }
    .wotd-definition {
      font-size: 0.85rem;
      line-height: 1.4;
      color: #aaa;
    }

    .word-title { font-weight:700; font-size:1.4rem; color:#0d6efd; margin-bottom:1rem; }
    .definition { font-size:1rem; line-height:1.5; margin-bottom:1rem; color:#eaeaea; }
    .sentence { color:#9cdcfe; margin-bottom:1rem; white-space:pre-wrap; }
    .more { font-size:0.9rem; color:#ce9178; }
    .badge-custom { background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); color:#999; font-size:0.75rem; font-weight:500; border-radius:6px; padding:0.25rem 0.5rem; }
    .fade-in { animation:fadeIn 0.4s ease; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }
    .cursor { display:inline-block; margin-left:4px; color:#0d6efd; animation:blink 1s step-start infinite; }
    @keyframes blink { 50% {opacity:0;} }
    .error-block { color:#ff6b6b; background:#2a0000; padding:1rem; border-radius:6px; margin-top:1rem; }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-md-3 col-lg-2 sidebar">
        <h2>
          <span>Welcome.</span>
          <span>
            <i id="settingsIcon" class="fa-solid fa-gear settings-icon"></i>
            <i id="helpIcon" class="fa-solid fa-circle-question settings-icon ms-3" title="Help"></i>
          </span>
        </h2>
        <button id="randomBtn" class="btn btn-sm btn-outline-primary btn-random">
          <i class="fa-solid fa-shuffle"></i> Random Word
        </button>
        <button id="contributeBtn" class="btn btn-sm btn-outline-success btn-contribute">
          <i class="fa-solid fa-plus"></i> Contribute
        </button>
        <input id="searchBox" type="text" class="form-control search-box" placeholder="Search...">
        <ul id="wordList" class="word-list"></ul>
      </div>

      <!-- Main Content -->
      <div class="col-md-9 col-lg-10 content">
        <p class="terminal-header">DevOps Terminology Toolkit</p>
        <div id="wordDetails" class="terminal-window">
          <div id="wotdBlock" class="word-of-day-block"></div>
          <div id="selectedWord" class="fade-in">
            <h1 class="word-title">&gt; Welcome and happy learning!</h1>
            <p class="sentence">Select or search for a word in the sidebar.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal fade" id="settingsModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content text-dark">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fa-solid fa-gear"></i> Settings</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="settingsForm">
            <div class="mb-3">
              <label class="form-label">Bin ID</label>
              <input type="text" class="form-control" id="settingsBinId" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Read Access Key</label>
              <input type="password" class="form-control" id="settingsReadKey" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">
              <i class="fa-solid fa-save"></i> Save Settings
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Contribute Modal -->
  <div class="modal fade" id="contributeModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content text-dark">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fa-solid fa-plus"></i> Contribute</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="instructions">Ensure you have the Write Access Key first from the administrator.</div>
          <form id="contributeForm">
            <div class="mb-3"><label class="form-label">Word</label><input id="contribWord" class="form-control" required></div>
            <div class="mb-3"><label class="form-label">Definition</label><textarea id="contribDefinition" class="form-control" required></textarea></div>
            <div class="mb-3"><label class="form-label">Sentence</label><textarea id="contribSentence" class="form-control"></textarea></div>
            <div class="mb-3"><label class="form-label">Category</label><input id="contribCategory" class="form-control"></div>
            <div class="mb-3"><label class="form-label">Write Access Key</label><input id="contribApiKey" type="password" class="form-control" required></div>
            <div id="contributeMessage"></div>
            <button type="submit" class="btn btn-success w-100"><i class="fa-solid fa-paper-plane"></i> Submit</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content text-dark">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fa-solid fa-pen"></i> Edit Entry</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="instructions">Ensure you have the Write Access Key first from the administrator.</div>
          <form id="editForm">
            <input type="hidden" id="editIndex">
            <div class="mb-3"><label class="form-label">Word</label><input id="editWord" class="form-control" required></div>
            <div class="mb-3"><label class="form-label">Definition</label><textarea id="editDefinition" class="form-control" required></textarea></div>
            <div class="mb-3"><label class="form-label">Sentence</label><textarea id="editSentence" class="form-control"></textarea></div>
            <div class="mb-3"><label class="form-label">Category</label><input id="editCategory" class="form-control"></div>
            <div class="mb-3"><label class="form-label">Write Access Key</label><input id="editApiKey" type="password" class="form-control" required></div>
            <div id="editMessage"></div>
            <button type="submit" class="btn btn-warning w-100"><i class="fa-solid fa-save"></i> Save</button>
          </form>
        </div>
      </div>
    </div>
  </div>

    <!-- Help Modal -->
  <div class="modal fade" id="helpModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content text-dark">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fa-solid fa-circle-question"></i> Help & FAQ</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="accordion" id="helpAccordion">

            <!-- How to Use -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingUse">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseUse" aria-expanded="true" aria-controls="collapseUse">
                  How to Use
                </button>
              </h2>
              <div id="collapseUse" class="accordion-collapse collapse show" aria-labelledby="headingUse" data-bs-parent="#helpAccordion">
                <div class="accordion-body">
                  Browse the dictionary using the list on the left. Click a word to see its definition and sample sentence. Use "Random Word" to explore, or search by keywords. You can contribute new words using the "Contribute" button.
                </div>
              </div>
            </div>

            <!-- How to Configure -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingConfig">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseConfig" aria-expanded="false" aria-controls="collapseConfig">
                  How to Configure
                </button>
              </h2>
              <div id="collapseConfig" class="accordion-collapse collapse" aria-labelledby="headingConfig" data-bs-parent="#helpAccordion">
                <div class="accordion-body">
                  Click the <i class="fa-solid fa-gear"></i> icon to open settings. Enter your the <strong>Bin ID</strong> and <strong>Read Access Key</strong> to load data. Save to persist configuration in your browser.
                </div>
              </div>
            </div>

            <!-- Tour / Sections -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingTour">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTour" aria-expanded="false" aria-controls="collapseTour">
                  Tour of Sections
                </button>
              </h2>
              <div id="collapseTour" class="accordion-collapse collapse" aria-labelledby="headingTour" data-bs-parent="#helpAccordion">
                <div class="accordion-body">
                  <ul>
                    <li><strong>Sidebar:</strong> Search words, browse list, random selection, contribute words.</li>
                    <li><strong>Main Content:</strong> Displays selected word, definition, sample sentence, category, and extra notes.</li>
                    <li><strong>Word of the Day:</strong> Rotates daily based on a starting date.</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- API Keys Explanation -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingKeys">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseKeys" aria-expanded="false" aria-controls="collapseKeys">
                  API Keys Explanation
                </button>
              </h2>
              <div id="collapseKeys" class="accordion-collapse collapse" aria-labelledby="headingKeys" data-bs-parent="#helpAccordion">
                <div class="accordion-body">
                  <ul>
                    <li><strong>Read Access Key:</strong> Required to fetch data from the database.</li>
                    <li><strong>Write Access Key:</strong> Required when contributing or editing words.</li>
                    <li>Keep your keys secure. Only store them locally in your browser or trusted environment.</li>
                  </ul>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // SETTINGS
    // let BIN_ID = localStorage.getItem("BIN_ID") || "";
    // let READ_API_KEY = localStorage.getItem("READ_API_KEY") || "";
    let BIN_ID = "68a68980d0ea881f405ed3e7"
    let READ_API_KEY = "$2a$10$ISBmoZy2xtYX4PTsoNRmw.3Y5xl9iRZO9YFtuJ0Ao7kYgZWBzJTTW";
    const settingsIcon = document.getElementById("settingsIcon");
    const settingsForm = document.getElementById("settingsForm");

    function checkSettings() {
      if (!BIN_ID || !READ_API_KEY) {
        settingsIcon.classList.add("settings-pulse");
        return false;
      } else {
        settingsIcon.classList.remove("settings-pulse");
        return true;
      }
    }

    settingsIcon.addEventListener("click", () => {
      document.getElementById("settingsBinId").value = BIN_ID;
      document.getElementById("settingsReadKey").value = READ_API_KEY;
      new bootstrap.Modal(document.getElementById("settingsModal")).show();
    });

    settingsForm.addEventListener("submit", (e) => {
      e.preventDefault();
      BIN_ID = document.getElementById("settingsBinId").value.trim();
      READ_API_KEY = document.getElementById("settingsReadKey").value.trim();
      localStorage.setItem("BIN_ID", BIN_ID);
      localStorage.setItem("READ_API_KEY", READ_API_KEY);
      checkSettings();
      bootstrap.Modal.getInstance(document.getElementById("settingsModal")).hide();
      refreshData();
    });

    // DATA & FUNCTIONS
    let data = [];
    let currentList = [];
    const wordList = document.getElementById("wordList");
    const selectedWordDiv = document.getElementById("selectedWord");
    const wotdBlock = document.getElementById("wotdBlock");

    async function fetchData() {
      if (!checkSettings()) return [];
      try {
        const url = "https://jsonkeeper.com/b/CQWDT"; // replace with your jsonkeeper URL
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status} - ${res.statusText}`);
        const json = await res.json();
        return json; // no .record here, JSONKeeper gives raw JSON
      } catch (err) {
        console.error("Failed to fetch JSON:", err);
        selectedWordDiv.innerHTML = `<div class="error-block"><strong>Error:</strong> ${err.message}</div>`;
        return [];
      }
    }

    async function updateData(apiKey, newData) {
      const url = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
      const res = await fetch(url, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Access-Key": apiKey
        },
        body: JSON.stringify(newData)
      });
      if (!res.ok) throw new Error(`HTTP ${res.status} – ${res.statusText}`);
      return res.json();
    }

    async function refreshData() {
      if (!checkSettings()) return;
      data = await fetchData();
      if (!data || data.length === 0) return;
      renderWordList(data);
      const { word: wotdWord } = getWordOfTheDay(data);
      const wotdDef = wotdWord.Definition.replace(/\n/g, "<br>");
      const wotdCategory = wotdWord.Category ? `<span class="badge-custom"><i class="fa-solid fa-tag"></i> ${wotdWord.Category}</span>` : "";
      wotdBlock.innerHTML = `
        <h2><i class="fa-solid fa-calendar-day"></i> Word of the Day</h2>
        <div class="word-of-day-inline">${wotdWord.Word} ${wotdCategory}</div>
        <div class="wotd-definition">${wotdDef}</div>
      `;
    }

    // async function fetchData() {
    //   if (!checkSettings()) return [];
    //   try {
    //     const url = `https://api.jsonbin.io/v3/b/${BIN_ID}/latest`;
    //     const res = await fetch(url, { headers: { "X-Access-Key": READ_API_KEY } });
    //     if (!res.ok) throw new Error(`HTTP ${res.status} – ${res.statusText}`);
    //     const json = await res.json();
    //     return json.record;
    //   } catch (err) {
    //     console.error("Failed to fetch JSON:", err);
    //     selectedWordDiv.innerHTML = `<div class="error-block"><strong>Error:</strong> ${err.message}</div>`;
    //     return [];
    //   }
    // }


    function renderWordList(words) {
      currentList = words;
      wordList.innerHTML = "";
      words.forEach((item, index) => {
        const li = document.createElement("li");
        li.textContent = item.Word;
        li.addEventListener("click", () => showWord(index, li));
        wordList.appendChild(li);
      });
    }

    function showWord(index, li=null) {
      const word = currentList[index];
      if (!word) return;
      if (li) {
        document.querySelectorAll(".word-list li").forEach(el => el.classList.remove("active"));
        li.classList.add("active");
      }
      const definition = word.Definition ? word.Definition.replace(/\n/g, "<br>") : "";
      const sentence   = word.Sentence ? word.Sentence.replace(/\n/g, "\n") : "";
      const more       = word.More ? word.More.replace(/\n/g, "<br>") : "";
      const category   = word.Category ? `<span class="badge-custom"><i class="fa-solid fa-tag"></i> ${word.Category}</span>` : "";
      selectedWordDiv.classList.remove("fade-in"); void selectedWordDiv.offsetWidth; selectedWordDiv.classList.add("fade-in");
      selectedWordDiv.innerHTML = `
        <h1 class="word-title">&gt; ${word.Word}<span class="cursor">_</span></h1>
        ${category ? `<div class="mb-3">${category}</div>` : ""}
        <p class="definition"><strong>Definition:</strong> ${definition}</p>
        <p class="sentence" id="typedSentence"><strong>Sample sentence:</strong><br></p>
        ${more ? `<p class="more"><i class="fa-solid fa-circle-info"></i> ${more}</p>` : ""}
        <button class="btn btn-sm btn-warning mt-3" onclick="openEditModal(${data.indexOf(word)})"><i class="fa-solid fa-pen"></i> Edit</button>
      `;
      if (sentence) typeSentence(sentence, document.getElementById("typedSentence"), 35);
    }

    function typeSentence(text, element, delay=40) {
      element.innerHTML = "<strong>Sample sentence:</strong><br>";
      let i=0;
      function typing() {
        if (i<text.length) {
          element.innerHTML += text.charAt(i) === "\n" ? "<br>" : text.charAt(i);
          i++; setTimeout(typing, delay);
        }
      }
      typing();
    }

    function getWordOfTheDay(data) {
      const startDate = new Date("2025-08-21");
      const today = new Date();
      const diffDays = Math.floor((today - startDate)/(1000*60*60*24));
      const index = ((diffDays % data.length)+data.length)%data.length;
      return {word:data[index], index};
    }

    // EVENTS
    document.getElementById("searchBox").addEventListener("input", e => {
      const query = e.target.value.toLowerCase();
      const filtered = data.filter(w => w.Word.toLowerCase().includes(query));
      renderWordList(filtered);
    });

    document.getElementById("randomBtn").addEventListener("click", () => {
      if (!data.length) return;
      const randIndex = Math.floor(Math.random()*data.length);
      showWord(randIndex);
    });

    document.getElementById("contributeBtn").addEventListener("click", () => {
      document.getElementById("contributeForm").reset();
      document.getElementById("contributeMessage").innerHTML="";
      new bootstrap.Modal(document.getElementById("contributeModal")).show();
    });

    helpIcon.addEventListener("click", () => {
      new bootstrap.Modal(document.getElementById("helpModal")).show();
    });

    document.getElementById("contributeForm").addEventListener("submit", async e => {
      e.preventDefault();
      const newEntry = {
        Word: document.getElementById("contribWord").value.trim(),
        Definition: document.getElementById("contribDefinition").value.trim(),
        Sentence: document.getElementById("contribSentence").value.trim(),
        Category: document.getElementById("contribCategory").value.trim()
      };
      const apiKey = document.getElementById("contribApiKey").value.trim();
      try {
        await updateData(apiKey, [...data,newEntry]);
        await refreshData();
        bootstrap.Modal.getInstance(document.getElementById("contributeModal")).hide();
      } catch(err) {
        document.getElementById("contributeMessage").innerHTML=`<div class="alert alert-danger">${err.message}</div>`;
      }
    });

    function openEditModal(index) {
      const w=data[index];
      document.getElementById("editIndex").value=index;
      document.getElementById("editWord").value=w.Word;
      document.getElementById("editDefinition").value=w.Definition;
      document.getElementById("editSentence").value=w.Sentence||"";
      document.getElementById("editCategory").value=w.Category||"";
      document.getElementById("editMessage").innerHTML="";
      new bootstrap.Modal(document.getElementById("editModal")).show();
    }

    document.getElementById("editForm").addEventListener("submit", async e => {
      e.preventDefault();
      const i=parseInt(document.getElementById("editIndex").value);
      data[i] = {
        Word: document.getElementById("editWord").value.trim(),
        Definition: document.getElementById("editDefinition").value.trim(),
        Sentence: document.getElementById("editSentence").value.trim(),
        Category: document.getElementById("editCategory").value.trim()
      };
      const apiKey=document.getElementById("editApiKey").value.trim();
      try {
        await updateData(apiKey,data);
        await refreshData();
        bootstrap.Modal.getInstance(document.getElementById("editModal")).hide();
      } catch(err) {
        document.getElementById("editMessage").innerHTML=`<div class="alert alert-danger">${err.message}</div>`;
      }
    });

    // INIT
    refreshData();
  </script>
</body>
</html>
